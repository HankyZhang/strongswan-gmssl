# strongSwan swanctl 配置文件
# 使用国密算法 (SM2/SM3/SM4) + PSK 认证
# 用于本地测试 (loopback)

connections {
    gmsm-psk {
        version = 2  # IKEv2
        
        # 本地端 (发起方)
        local {
            auth = psk
            id = vpn-client@test.local
        }
        
        # 远程端 (响应方)
        remote {
            auth = psk
            id = vpn-server@test.local
        }
        
        # IKE 算法提案 (当前使用标准算法测试)
        # 目标: sm4-sm3-modp2048 (需要添加关键字支持)
        proposals = aes256-sha256-modp2048
        
        # Child SA 配置
        children {
            gmsm-tunnel {
                # ESP 算法提案 (使用国密算法)
                # 先用 AES 测试连接，之后再替换为 SM4
                esp_proposals = aes256-sha256-modp2048
                
                # 流量选择器
                local_ts = 10.0.0.1/32
                remote_ts = 10.0.0.2/32
                
                # 自动启动
                start_action = trap
                dpd_action = restart
                close_action = restart
            }
        }
    }
}

# PSK 密钥配置
secrets {
    ike-1 {
        id-client = vpn-client@test.local
        id-server = vpn-server@test.local
        secret = "GmSM_Test_PSK_2024"
    }
}
