# strongSwan swanctl 配置文件 - Loopback 测试版
# 使用 PSK 认证 + AES 算法
# 本地测试：127.0.0.1 作为客户端和服务端

connections {
    gmsm-loopback {
        version = 2  # IKEv2
        
        # 本地端配置
        local_addrs = 127.0.0.1
        
        # 远程端配置（指向本地，模拟 loopback）
        remote_addrs = 127.0.0.1
        
        # 本地认证
        local {
            auth = psk
            id = vpn-client@test.local
        }
        
        # 远程认证
        remote {
            auth = psk
            id = vpn-server@test.local
        }
        
        # IKE 算法提案 (标准算法)
        proposals = aes256-sha256-modp2048
        
        # Child SA 配置
        children {
            gmsm-tunnel {
                # ESP 算法提案
                esp_proposals = aes256-sha256
                
                # 流量选择器
                local_ts = 192.168.100.1/32
                remote_ts = 192.168.100.2/32
                
                # 启动方式
                start_action = none
                dpd_action = restart
                close_action = none
            }
        }
    }
}

# PSK 密钥配置
secrets {
    ike-1 {
        id-client = vpn-client@test.local
        id-server = vpn-server@test.local
        secret = "GmSM_Test_PSK_2024"
    }
}
