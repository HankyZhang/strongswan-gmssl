# ==============================================================================
# strongSwan + GmSSL 配置文件
# 支持国密算法: SM2/SM3/SM4
# 本地端配置
# ==============================================================================

connections {
   # 国密算法连接（优先）
   site-to-cloud-gm {
      version = 2
      local_addrs = 0.0.0.0
      remote_addrs = 101.126.148.5
      
      local {
         auth = psk
         id = site-vpn-gm
      }
      
      remote {
         auth = psk
         id = cloud-server-gm
      }
      
      children {
         cloud-net-gm {
            local_ts = 10.1.0.0/24
            remote_ts = 10.2.0.0/24
            
            # 使用国密算法组合
            # SM4-GCM: 国密对称加密（认证加密模式）
            # SM3: 国密哈希算法
            # MODP-2048: DH 密钥交换
            esp_proposals = sm4gcm128-sm3-modp2048,sm4cbc-sm3-modp2048
            
            start_action = start
            dpd_action = restart
            close_action = restart
            
            # 重新密钥间隔
            rekey_time = 1h
            life_time = 1h30m
         }
      }
      
      # IKE 提案：优先使用国密算法
      # SM4-CBC: 国密对称加密
      # SM3: 国密哈希/PRF
      # SM2: 国密非对称加密（密钥交换）
      proposals = sm4cbc-sm3-sm2,sm4cbc128-sm3-modp2048,aes256-sha256-modp2048
      
      # 重新密钥配置
      rekey_time = 4h
      over_time = 30m
   }
   
   # 传统算法连接（备用）
   site-to-cloud-legacy {
      version = 2
      local_addrs = 0.0.0.0
      remote_addrs = 101.126.148.5
      
      local {
         auth = psk
         id = site-vpn
      }
      
      remote {
         auth = psk
         id = cloud-server
      }
      
      children {
         cloud-net-legacy {
            local_ts = 10.1.0.0/24
            remote_ts = 10.2.0.0/24
            
            # 传统算法组合
            esp_proposals = aes256gcm128-sha256-modp2048,aes256-sha256-modp2048
            
            start_action = none
            dpd_action = restart
         }
      }
      
      proposals = aes256-sha256-modp2048
   }
}

# 密钥配置
secrets {
   # 国密连接密钥
   ike-gm {
      id-local = site-vpn-gm
      id-remote = cloud-server-gm
      secret = "MyStrongPSK2024!@#SecureVPN"
   }
   
   # 传统连接密钥
   ike-legacy {
      id-local = site-vpn
      id-remote = cloud-server
      secret = "MyStrongPSK2024!@#SecureVPN"
   }
}

# 连接池（如果需要分配虚拟IP）
# pools {
#    ipv4-pool {
#       addrs = 10.1.1.0/24
#    }
# }
